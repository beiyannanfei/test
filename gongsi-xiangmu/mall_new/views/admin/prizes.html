<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>奖品列表</title>
    <link rel="stylesheet" type="text/css" media="screen" href="/stylesheets/style.css" />

    <style type="text/css">
        .top_tit01{ height:74px;line-height: 74px;padding-left: 20px;border: solid 1px #e4e4e4;margin-bottom: 30px; font-family: "微软雅黑"}
        .top_tit01 strong{ float:right; position:relative; top:-3px;padding:2px 10px; background:#0090ff; border-radius:4px; font-size:14px; color:#fff; font-weight:normal;}
        .top_tit01 strong:hover{ cursor:pointer; background:#0079d6;}
        .top_search{ overflow:hidden; clear:both; padding:10px 0 0; text-align:right}
        .top_search *{ font-size:13px}
        .top_search .w1{ width:160px; border:solid 1px #c9c9c9; padding:3px 4px;font-family:"微软雅黑"; border-radius:3px; box-shadow:inset 0 1px 3px #ddd; line-height:18px}
        .top_search .btn{ width:50px; height:26px; padding:1px 0 3px;border:solid 1px #c9c9c9; background:#f9f9f9;border-radius:3px; cursor:pointer }
        .top_search .btn:hover{ background:#eee}

        .t_form1{position:relative; margin-top:20px}
        .t_form1 dt{ clear:both; overflow:hidden; padding:6px 0; margin-bottom:10px; background:#95c2eb; color:#fff }
        .t_form1 dd{ clear:both; margin-bottom:15px;padding:25px 0; border:solid 1px #e7e7eb;width:100%}
        .t_form1 dd:hover{ background:#f9f9f9}
        .t_form1 th{ font-size:14px}
        .t_form1 td{ text-align:center; font-size:14px; color:#000}

        .t_form1 td.address{ position:relative; }
        .t_form1 td.address strong{display:inline-block; width:70px; border:solid 1px #ddd;padding:2px 0; background:#fff; border-radius:4px; font-size:14px; font-weight:normal; cursor:pointer}
        .t_form1 td.address strong:hover,.t_form1 td.address.on strong{ border:solid 1px #0090ff; color:#0090ff}
        .t_form1 td.address .url{ display:none; position:absolute; right:-50px; top:50%; margin-top:15px; background:#fff; border:solid 1px #ddd; padding:4px 6px; box-shadow:0 0 3px #ccc; border-radius:4px; white-space:nowrap }
        .t_form1 td.address .url i{ margin-left:10px; cursor:pointer; color:#0090ff}

        .t_form1 td.address.on .url{ display:block}
        .t_form1 td .e1{ width:80%; border:solid 1px #e7e7eb; padding:3px 4px 4px; font-family:"微软雅黑"; font-size:14px}
        .t_form1 td.good{ text-align:left}
        .t_form1 td.good img{ float:left; padding:2px; border:solid 1px #ddd; margin:0 15px 0 30px; max-width:100px; max-height:100px}
        .t_form1 td.good h3{ margin-top:7px;}
        .t_form1 td.good p{ margin-top:4px;}
        .operate1 strong{ display:inline-block; margin:0 5px; padding:3px 0; font-size:14px; border-radius:3px; font-weight:normal; color:#0090ff; cursor:pointer;}
        .operate1 strong:hover{ color:#0068b9}

        .pop_page1{ position:fixed; min-width:300px; background:#fff; border-radius:5px; box-shadow:0 1px 5px rgba(0,0,0,.2); display: none; top:50%; left:50%; width:420px;margin:-80px 0 0 -210px; z-index:10;}
        .pop_page1 .title{ height:45px; background:#0090ff; padding:0 15px;border-radius:5px 5px 0 0;}
        .pop_page1 .title strong{ float:left; color:#fff; font-size:14px; line-height:45px; font-weight:normal}
        .pop_page1 .title .close{ float:right; width:15px; height:15px; margin:15px 0 0; background:url(/images/close.png) no-repeat center center; text-indent:-9999px; cursor:pointer}
        .pop_page1 .title .close:hover{opacity:.8; background-color:#000}
        .pop_page1 .cnt_code1{ margin:10px auto; text-align:center}
        .pop_page1 .cnt_code1 img{ width:160px; height:160px;}
        .pop_page1 .cnt_code1 p{ margin-top:8px; font-size:14px}
        .pop_page1 .cnt2{ margin:20px auto;}
        .pop_page1 .cnt2 .tip{ text-align:center; font-size:14px}
        .pop_page1 .cnt2 .btn{ margin-top:20px; text-align:center}
        .pop_page1 .cnt2 .btn strong{display:inline-block; width:85px; margin:0 5px; padding:5px 0; background:#0090ff; font-size:14px; border-radius:3px; font-weight:normal; color:#fff; cursor:pointer; text-align:center}
        .pop_page1 .cnt2 .btn strong.cancel{ background:#ff5252}
        .list_msg1 li.min_padding td{color: #333;text-align: center;width:20%;}
        .list_msg1 li table.t1 td{text-align: center;width:20%;}
    </style>

</head>
<body>
    <div class="normalheader transition animated fadeIn">
        <div class="hpanel">
            <div class="panel-body">
                <a class="small-header-action" href="">
                    <div class="clip-header">
                        <i class="fa fa-arrow-up"></i>
                    </div>
                </a>

                <div id="hbreadcrumb" class="pull-right m-t-lg">
                    <ol class="hbreadcrumb breadcrumb">
                        <li><a href="#">奖品管理</a></li>
                        <li>
                            <span>奖品列表</span>
                        </li>
                    </ol>
                </div>
                <h2 class="font-light m-b-xs" style="font-size:30px;">
                    奖品管理
                </h2>
                <small>奖品列表</small>
            </div>
        </div>
    </div>
<div class="hpanel" style="padding:20px 40px 0 40px;margin-bottom:0">
    <div class="hpanel" style="margin-bottom:0">
        <ul class="nav nav-tabs">
            <li><a href="/admin/goods" aria-expanded="true">商品列表</a></li>
            <li class="active"><a href="/admin/prize" aria-expanded="false">奖品列表</a></li>
        </ul>
    </div>
</div>
<div class="wrap01" style="margin:0 40px 0 40px;background:#fff">
    <h3 class="tit02 fbhd">
        <a href="/admin/add/goods?type=jiang_pin" class="btn btn-success" style="background: #62cb31;margin-right:30px;margin-top:15px;margin-bottom:20px;">+添加奖品</a>
    </h3>

    <ul class="list_msg1 list_msg2">
        <li class="min_padding" style="background:#f7f9fa;padding:13px 0;border-top: solid 1px #e7e7ea;border-bottom: solid 1px #e7e7ea;";>
            <table width="100%" border="0" cellspacing="0" cellpadding="0" class="t1">
                <colgroup>
                    <col width="65">
                    <col width="*">
                    <col width="10%">
                    <col width="30%">
                    <col width="24%">
                </colgroup>
                <tr>
                    <td>
                        奖品图
                    </td>
                    <td>
                        奖品名
                    </td>
                    <td>库存</td>
                    <td>奖品价值</td>
                    <td class="icos2">操作</td>
                </tr>
            </table>
        </li>
        {{#each goods}}
            <li goodId="{{_id}}">
                <table width="100%" border="0" cellspacing="0" cellpadding="0" class="t1">
                    <colgroup>
                        <col width="65">
                        <col width="*">
                        <col width="10%">
                        <col width="30%">
                        <col width="24%">
                    </colgroup>
                    <tr>
                        <td class="avatar" style="width:20%;">
                            <div class="pic"><a href="#"><img src="{{pic}}"></a></div>
                        </td>
                        <td class="date">
                            {{name}}
                        </td>
                        <td class="date">
                            {{count}}
                        </td>
                        <td class="date">{{price}}</td>
                        <td class="icos icos2">
                            <a class="delete">删除</button>
                            <a href="/admin/goods/{{_id}}/update">编辑</a>
                        </td>
                    </tr>
                </table>
            </li>
        {{/each}}
    </ul>
    <!--<div class="pagenavi">
        <em class="pre"><strong>&lt;!&ndash;上一页&ndash;&gt;</strong></em>
        <span class="page_st">2/11</span>
        <em class="next"><strong>&lt;!&ndash;下一页&ndash;&gt;</strong></em>
        <span class="input_number"><input name="" type="text" /></span>
        <span class="btn_send">跳转</span>
    </div>-->
</div>
<script type="text/javascript" src="/javascripts/toast.js"></script>
<script type="text/javascript">
    $(function () {
        $('#delete-pop').find('.confirm').click(function(){
            var goodsId = $('#delete-pop').attr('goodsId');
            deleteGoods(goodsId);
            $('#delete-pop').hide();
        })

        $('#delete-pop').find('.close').click(function(){
            $('#delete-pop').removeAttr('goodsId');
            $('#delete-pop').hide();
        })

        $('#delete-pop').find('.cancel').click(function(){
            $('#delete-pop').removeAttr('goodsId');
            $('#delete-pop').hide();
        })

        $('.delete').click(function(){
            var goodId = $(this).closest('li').attr('goodId');
            swal({
                    title: "确定要删除吗",
                    text: "删除后不能撤回",
                    type: "warning",
                    showCancelButton: true,
                    confirmButtonColor: "#DD6B55",
                    confirmButtonText: "确定",
                    cancelButtonText: "取消",
                    closeOnConfirm: false,
                    closeOnCancel: true
                    },
                    function (isConfirm) {
                        if (isConfirm) {
                            deleteGoods(goodId, function(err){
                                if (err){
                                    swal("删除失败");
                                } else {
                                    swal("删除成功");
                                }
                            })
                        }
                    }
                )
        })

        function deleteGoods(goodsId,cb){
            $.ajax({
                type: 'DELETE',
                url: "/admin/goods/" + goodsId,
                success: function(data){
                    $('li[goodId=' + goodsId + ']').slideUp();
                    cb();
                },
                error: function(){
                    /*$.showToast('删除失败');*/
                    cb(err);
                }
            })
        }
    });
</script>
</body>
</html>

