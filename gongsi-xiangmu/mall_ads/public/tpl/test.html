<script>
    /**
     * DEVELOPED BY
     * GIL LOPES BUENO
     * gilbueno.mail@gmail.com
     *
     * WORKS WITH:
     * IE8*, IE 9+, FF 4+, SF 5+, WebKit, CH 7+, OP 12+, BESEN, Rhino 1.7+
     * For IE8 (and other legacy browsers) WatchJS will use dirty checking
     *
     * FORK:
     * https://github.com/melanke/Watch.JS
     */

    "use strict";
    (function (factory) {
        if (typeof exports === 'object') {
            // Node. Does not work with strict CommonJS, but
            // only CommonJS-like enviroments that support module.exports,
            // like Node.
            module.exports = factory();
        }  else {
            // Browser globals
            window.WatchJS = factory();
            window.watch = window.WatchJS.watch;
            window.unwatch = window.WatchJS.unwatch;
            window.callWatchers = window.WatchJS.callWatchers;
        }
    }(function () {

        var WatchJS = {
                    noMore: false,        // use WatchJS.suspend(obj) instead
                    useDirtyCheck: false // use only dirty checking to track changes.
                },
                lengthsubjects = [];

        var dirtyChecklist = [];
        var pendingChanges = []; // used coalesce changes from defineProperty and __defineSetter__

        var supportDefineProperty = false;
        try {
            supportDefineProperty = Object.defineProperty && Object.defineProperty({},'x', {});
        } catch(ex) {  /* not supported */  }

        var isFunction = function (functionToCheck) {
            var getType = {};
            return functionToCheck && getType.toString.call(functionToCheck) == '[object Function]';
        };

        var isInt = function (x) {
            return x % 1 === 0;
        };

        var isArray = function(obj) {
            return Object.prototype.toString.call(obj) === '[object Array]';
        };

        var isObject = function(obj) {
            return {}.toString.apply(obj) === '[object Object]';
        };

        var getObjDiff = function(a, b){
            var aplus = [],
                    bplus = [];

            if(!(typeof a == "string") && !(typeof b == "string")){

                if (isArray(a)) {
                    for (var i=0; i<a.length; i++) {
                        if (b[i] === undefined) aplus.push(i);
                    }
                } else {
                    for(var i in a){
                        if (a.hasOwnProperty(i)) {
                            if(b[i] === undefined) {
                                aplus.push(i);
                            }
                        }
                    }
                }

                if (isArray(b)) {
                    for (var j=0; j<b.length; j++) {
                        if (a[j] === undefined) bplus.push(j);
                    }
                } else {
                    for(var j in b){
                        if (b.hasOwnProperty(j)) {
                            if(a[j] === undefined) {
                                bplus.push(j);
                            }
                        }
                    }
                }
            }

            return {
                added: aplus,
                removed: bplus
            }
        };

        var clone = function(obj){

            if (null == obj || "object" != typeof obj) {
                return obj;
            }

            var copy = obj.constructor();

            for (var attr in obj) {
                copy[attr] = obj[attr];
            }

            return copy;

        }

        var defineGetAndSet = function (obj, propName, getter, setter) {
            try {
                Object.observe(obj, function(changes) {
                    changes.forEach(function(change) {
                        if (change.name === propName) {
                            setter(change.object[change.name]);
                        }
                    });
                });
            }
            catch(e) {
                try {
                    Object.defineProperty(obj, propName, {
                        get: getter,
                        set: function(value) {
                            setter.call(this,value,true); // coalesce changes
                        },
                        enumerable: true,
                        configurable: true
                    });
                }
                catch(e2) {
                    try{
                        Object.prototype.__defineGetter__.call(obj, propName, getter);
                        Object.prototype.__defineSetter__.call(obj, propName, function(value) {
                            setter.call(this,value,true); // coalesce changes
                        });
                    }
                    catch(e3) {
                        observeDirtyChanges(obj,propName,setter);
                        //throw new Error("watchJS error: browser not supported :/")
                    }
                }
            }
        };

        var defineProp = function (obj, propName, value) {
            try {
                Object.defineProperty(obj, propName, {
                    enumerable: false,
                    configurable: true,
                    writable: false,
                    value: value
                });
            } catch(error) {
                obj[propName] = value;
            }
        };

        var observeDirtyChanges = function(obj,propName,setter) {
            dirtyChecklist[dirtyChecklist.length] = {
                prop:       propName,
                object:     obj,
                orig:       clone(obj[propName]),
                callback:   setter
            }
        }

        var watch = function () {

            if (isFunction(arguments[1])) {
                watchAll.apply(this, arguments);
            } else if (isArray(arguments[1])) {
                watchMany.apply(this, arguments);
            } else {
                watchOne.apply(this, arguments);
            }

        };


        var watchAll = function (obj, watcher, level, addNRemove) {

            if ((typeof obj == "string") || (!(obj instanceof Object) && !isArray(obj))) { //accepts only objects and array (not string)
                return;
            }

            if(isArray(obj)) {
                defineWatcher(obj, "__watchall__", watcher, level); // watch all changes on the array
                if (level===undefined||level > 0) {
                    for (var prop = 0; prop < obj.length; prop++) { // watch objects in array
                        watchAll(obj[prop],watcher,level, addNRemove);
                    }
                }
            }
            else {
                var prop,props = [];
                for (prop in obj) { //for each attribute if obj is an object
                    if (prop == "$val" || (!supportDefineProperty && prop === 'watchers')) {
                        continue;
                    }

                    if (Object.prototype.hasOwnProperty.call(obj, prop)) {
                        props.push(prop); //put in the props
                    }
                }
                watchMany(obj, props, watcher, level, addNRemove); //watch all items of the props
            }


            if (addNRemove) {
                pushToLengthSubjects(obj, "$$watchlengthsubjectroot", watcher, level);
            }
        };


        var watchMany = function (obj, props, watcher, level, addNRemove) {

            if ((typeof obj == "string") || (!(obj instanceof Object) && !isArray(obj))) { //accepts only objects and array (not string)
                return;
            }

            for (var i=0; i<props.length; i++) { //watch each property
                var prop = props[i];
                watchOne(obj, prop, watcher, level, addNRemove);
            }

        };

        var watchOne = function (obj, prop, watcher, level, addNRemove) {
            if ((typeof obj == "string") || (!(obj instanceof Object) && !isArray(obj))) { //accepts only objects and array (not string)
                return;
            }

            if(isFunction(obj[prop])) { //dont watch if it is a function
                return;
            }
            if(obj[prop] != null && (level === undefined || level > 0)){
                watchAll(obj[prop], watcher, level!==undefined? level-1 : level); //recursively watch all attributes of this
            }

            defineWatcher(obj, prop, watcher, level);

            if(addNRemove && (level === undefined || level > 0)){
                pushToLengthSubjects(obj, prop, watcher, level);
            }

        };

        var unwatch = function () {

            if (isFunction(arguments[1])) {
                unwatchAll.apply(this, arguments);
            } else if (isArray(arguments[1])) {
                unwatchMany.apply(this, arguments);
            } else {
                unwatchOne.apply(this, arguments);
            }

        };

        var unwatchAll = function (obj, watcher) {

            if (obj instanceof String || (!(obj instanceof Object) && !isArray(obj))) { //accepts only objects and array (not string)
                return;
            }

            if (isArray(obj)) {
                var props = ['__watchall__'];
                for (var prop = 0; prop < obj.length; prop++) { //for each item if obj is an array
                    props.push(prop); //put in the props
                }
                unwatchMany(obj, props, watcher); //watch all itens of the props
            } else {
                var unwatchPropsInObject = function (obj2) {
                    var props = [];
                    for (var prop2 in obj2) { //for each attribute if obj is an object
                        if (obj2.hasOwnProperty(prop2)) {
                            if (obj2[prop2] instanceof Object) {
                                unwatchPropsInObject(obj2[prop2]); //recurs into object props
                            } else {
                                props.push(prop2); //put in the props
                            }
                        }
                    }
                    unwatchMany(obj2, props, watcher); //unwatch all of the props
                };
                unwatchPropsInObject(obj);
            }
        };


        var unwatchMany = function (obj, props, watcher) {

            for (var prop2 in props) { //watch each attribute of "props" if is an object
                if (props.hasOwnProperty(prop2)) {
                    unwatchOne(obj, props[prop2], watcher);
                }
            }
        };

        var timeouts = [],
                timerID = null;
        function clearTimerID() {
            timerID = null;
            for(var i=0; i< timeouts.length; i++) {
                timeouts[i]();
            }
            timeouts.length = 0;
        }
        var getTimerID= function () {
            if (!timerID)  {
                timerID = setTimeout(clearTimerID);
            }
            return timerID;
        }
        var registerTimeout = function(fn) { // register function to be called on timeout
            if (timerID==null) getTimerID();
            timeouts[timeouts.length] = fn;
        }

        // Track changes made to an array, object or an object's property
        // and invoke callback with a single change object containing type, value, oldvalue and array splices
        // Syntax:
        //      trackChange(obj, callback, recursive, addNRemove)
        //      trackChange(obj, prop, callback, recursive, addNRemove)
        var trackChange = function() {
            var fn = (isFunction(arguments[2])) ? trackProperty : trackObject ;
            fn.apply(this,arguments);
        }

        // track changes made to an object and invoke callback with a single change object containing type, value and array splices
        var trackObject= function(obj, callback, recursive, addNRemove) {
            var change = null,lastTimerID = -1;
            var isArr = isArray(obj);
            var level,fn = function(prop, action, newValue, oldValue) {
                var timerID = getTimerID();
                if (lastTimerID!==timerID) { // check if timer has changed since last update
                    lastTimerID = timerID;
                    change = {
                        type: 'update'
                    }
                    change['value'] = obj;
                    change['splices'] = null;
                    registerTimeout(function() {
                        callback.call(this,change);
                        change = null;
                    });
                }
                // create splices for array changes
                if (isArr && obj === this && change !== null)  {
                    if (action==='pop'||action==='shift') {
                        newValue = [];
                        oldValue = [oldValue];
                    }
                    else if (action==='push'||action==='unshift') {
                        newValue = [newValue];
                        oldValue = [];
                    }
                    else if (action!=='splice') {
                        return; // return here - for reverse and sort operations we don't need to return splices. a simple update will do
                    }
                    if (!change.splices) change.splices = [];
                    change.splices[change.splices.length] = {
                        index: prop,
                        deleteCount: oldValue ? oldValue.length : 0,
                        addedCount: newValue ? newValue.length : 0,
                        added: newValue,
                        deleted: oldValue
                    };
                }

            }
            level = (recursive==true) ? undefined : 0;
            watchAll(obj,fn, level, addNRemove);
        }

        // track changes made to the property of an object and invoke callback with a single change object containing type, value, oldvalue and splices
        var trackProperty = function(obj,prop,callback,recursive, addNRemove) {
            if (obj && prop) {
                watchOne(obj,prop,function(prop, action, newvalue, oldvalue) {
                    var change = {
                        type: 'update'
                    }
                    change['value'] = newvalue;
                    change['oldvalue'] = oldvalue;
                    if (recursive && isObject(newvalue)||isArray(newvalue)) {
                        trackObject(newvalue,callback,recursive, addNRemove);
                    }
                    callback.call(this,change);
                },0)

                if (recursive && isObject(obj[prop])||isArray(obj[prop])) {
                    trackObject(obj[prop],callback,recursive, addNRemove);
                }
            }
        }


        var defineWatcher = function (obj, prop, watcher, level) {
            var newWatcher = false;
            var isArr = isArray(obj);

            if (!obj.watchers) {
                defineProp(obj, "watchers", {});
                if (isArr) {
                    // watch array functions
                    watchFunctions(obj, function(index,action,newValue, oldValue) {
                        addPendingChange(obj, index, action,newValue, oldValue);
                        if (level !== 0 && newValue && (isObject(newValue) || isArray(newValue))) {
                            var i,n, ln, wAll, watchList = obj.watchers[prop];
                            if ((wAll = obj.watchers['__watchall__'])) {
                                watchList = watchList ? watchList.concat(wAll) : wAll;
                            }
                            ln = watchList ?  watchList.length : 0;
                            for (i = 0; i<ln; i++) {
                                if (action!=='splice') {
                                    watchAll(newValue, watchList[i], (level===undefined)?level:level-1);
                                }
                                else {
                                    // watch spliced values
                                    for(n=0; n < newValue.length; n++) {
                                        watchAll(newValue[n], watchList[i], (level===undefined)?level:level-1);
                                    }
                                }
                            }
                        }
                    });
                }
            }

            if (!obj.watchers[prop]) {
                obj.watchers[prop] = [];
                if (!isArr) newWatcher = true;
            }

            for (var i=0; i<obj.watchers[prop].length; i++) {
                if(obj.watchers[prop][i] === watcher){
                    return;
                }
            }

            obj.watchers[prop].push(watcher); //add the new watcher to the watchers array

            if (newWatcher) {
                var val = obj[prop];
                var getter = function () {
                    return val;
                };

                var setter = function (newval, delayWatcher) {
                    var oldval = val;
                    val = newval;
                    if (level !== 0
                            && obj[prop] && (isObject(obj[prop]) || isArray(obj[prop]))
                            && !obj[prop].watchers) {
                        // watch sub properties
                        var i,ln = obj.watchers[prop].length;
                        for(i=0; i<ln; i++) {
                            watchAll(obj[prop], obj.watchers[prop][i], (level===undefined)?level:level-1);
                        }
                    }

                    //watchFunctions(obj, prop);

                    if (isSuspended(obj, prop)) {
                        resume(obj, prop);
                        return;
                    }

                    if (!WatchJS.noMore){ // this does not work with Object.observe
                        //if (JSON.stringify(oldval) !== JSON.stringify(newval)) {
                        if (oldval !== newval) {
                            if (!delayWatcher) {
                                callWatchers(obj, prop, "set", newval, oldval);
                            }
                            else {
                                addPendingChange(obj, prop, "set", newval, oldval);
                            }
                            WatchJS.noMore = false;
                        }
                    }
                };

                if (WatchJS.useDirtyCheck) {
                    observeDirtyChanges(obj,prop,setter);
                }
                else {
                    defineGetAndSet(obj, prop, getter, setter);
                }
            }

        };

        var callWatchers = function (obj, prop, action, newval, oldval) {
            if (prop !== undefined) {
                var ln, wl, watchList = obj.watchers[prop];
                if ((wl = obj.watchers['__watchall__'])) {
                    watchList = watchList ? watchList.concat(wl) : wl;
                }
                ln = watchList ? watchList.length : 0;
                for (var wr=0; wr< ln; wr++) {
                    watchList[wr].call(obj, prop, action, newval, oldval);
                }
            } else {
                for (var prop in obj) {//call all
                    if (obj.hasOwnProperty(prop)) {
                        callWatchers(obj, prop, action, newval, oldval);
                    }
                }
            }
        };

        var methodNames = ['pop', 'push', 'reverse', 'shift', 'sort', 'slice', 'unshift', 'splice'];
        var defineArrayMethodWatcher = function (obj, original, methodName, callback) {
            defineProp(obj, methodName, function () {
                var index = 0;
                var i,newValue, oldValue, response;
                // get values before splicing array
                if (methodName === 'splice') {
                    var start = arguments[0];
                    var end = start + arguments[1];
                    oldValue = obj.slice(start,end);
                    newValue = [];
                    for(i=2;i<arguments.length;i++) {
                        newValue[i-2] = arguments[i];
                    }
                    index = start;
                }
                else {
                    newValue = arguments.length > 0 ? arguments[0] : undefined;
                }

                response = original.apply(obj, arguments);
                if (methodName !== 'slice') {
                    if (methodName === 'pop') {
                        oldValue = response;
                        index = obj.length;
                    }
                    else if (methodName === 'push') {
                        index = obj.length-1;
                    }
                    else if (methodName === 'shift') {
                        oldValue = response;
                    }
                    else if (methodName !== 'unshift' && newValue===undefined) {
                        newValue = response;
                    }
                    callback.call(obj, index, methodName,newValue, oldValue)
                }
                return response;
            });
        };

        var watchFunctions = function(obj, callback) {

            if (!isFunction(callback) || !obj || (obj instanceof String) || (!isArray(obj))) {
                return;
            }

            for (var i = methodNames.length, methodName; i--;) {
                methodName = methodNames[i];
                defineArrayMethodWatcher(obj, obj[methodName], methodName, callback);
            }

        };

        var unwatchOne = function (obj, prop, watcher) {
            if (obj.watchers[prop]) {
                if (watcher===undefined) {
                    delete obj.watchers[prop]; // remove all property watchers
                }
                else {
                    for (var i=0; i<obj.watchers[prop].length; i++) {
                        var w = obj.watchers[prop][i];

                        if (w == watcher) {
                            obj.watchers[prop].splice(i, 1);
                        }
                    }
                }
            }
            removeFromLengthSubjects(obj, prop, watcher);
            removeFromDirtyChecklist(obj, prop);
        };

        // suspend watchers until next update cycle
        var suspend = function(obj, prop) {
            if (obj.watchers) {
                var name = '__wjs_suspend__'+(prop!==undefined ? prop : '');
                obj.watchers[name] = true;
            }
        }

        var isSuspended = function(obj, prop) {
            return obj.watchers
                    && (obj.watchers['__wjs_suspend__'] ||
                    obj.watchers['__wjs_suspend__'+prop]);
        }

        // resumes preivously suspended watchers
        var resume = function(obj, prop) {
            registerTimeout(function() {
                delete obj.watchers['__wjs_suspend__'];
                delete obj.watchers['__wjs_suspend__'+prop];
            })
        }

        var pendingTimerID = null;
        var addPendingChange = function(obj,prop, mode, newval, oldval) {
            pendingChanges[pendingChanges.length] = {
                obj:obj,
                prop: prop,
                mode: mode,
                newval: newval,
                oldval: oldval
            };
            if (pendingTimerID===null) {
                pendingTimerID = setTimeout(applyPendingChanges);
            }
        };


        var applyPendingChanges = function()  {
            // apply pending changes
            var change = null;
            pendingTimerID = null;
            for(var i=0;i < pendingChanges.length;i++) {
                change = pendingChanges[i];
                callWatchers(change.obj, change.prop, change.mode, change.newval, change.oldval);
            }
            if (change) {
                pendingChanges = [];
                change = null;
            }
        }

        var loop = function(){

            // check for new or deleted props
            for(var i=0; i<lengthsubjects.length; i++) {

                var subj = lengthsubjects[i];

                if (subj.prop === "$$watchlengthsubjectroot") {

                    var difference = getObjDiff(subj.obj, subj.actual);

                    if(difference.added.length || difference.removed.length){
                        if(difference.added.length){
                            watchMany(subj.obj, difference.added, subj.watcher, subj.level - 1, true);
                        }

                        subj.watcher.call(subj.obj, "root", "differentattr", difference, subj.actual);
                    }
                    subj.actual = clone(subj.obj);


                } else {

                    var difference = getObjDiff(subj.obj[subj.prop], subj.actual);

                    if(difference.added.length || difference.removed.length){
                        if(difference.added.length){
                            for (var j=0; j<subj.obj.watchers[subj.prop].length; j++) {
                                watchMany(subj.obj[subj.prop], difference.added, subj.obj.watchers[subj.prop][j], subj.level - 1, true);
                            }
                        }

                        callWatchers(subj.obj, subj.prop, "differentattr", difference, subj.actual);
                    }

                    subj.actual = clone(subj.obj[subj.prop]);

                }

            }

            // start dirty check
            var n, value;
            if (dirtyChecklist.length > 0) {
                for (var i = 0; i < dirtyChecklist.length; i++) {
                    n = dirtyChecklist[i];
                    value = n.object[n.prop];
                    if (!compareValues(n.orig, value)) {
                        n.orig = clone(value);
                        n.callback(value);
                    }
                }
            }

        };

        var compareValues =  function(a,b) {
            var i, state = true;
            if (a!==b)  {
                if (isObject(a)) {
                    for(i in a) {
                        if (!supportDefineProperty && i==='watchers') continue;
                        if (a[i]!==b[i]) {
                            state = false;
                            break;
                        };
                    }
                }
                else {
                    state = false;
                }
            }
            return state;
        }

        var pushToLengthSubjects = function(obj, prop, watcher, level){

            var actual;

            if (prop === "$$watchlengthsubjectroot") {
                actual =  clone(obj);
            } else {
                actual = clone(obj[prop]);
            }

            lengthsubjects.push({
                obj: obj,
                prop: prop,
                actual: actual,
                watcher: watcher,
                level: level
            });
        };

        var removeFromLengthSubjects = function(obj, prop, watcher){

            for (var i=0; i<lengthsubjects.length; i++) {
                var subj = lengthsubjects[i];

                if (subj.obj == obj && subj.prop == prop && subj.watcher == watcher) {
                    lengthsubjects.splice(i, 1);
                }
            }

        };

        var removeFromDirtyChecklist = function(obj, prop){
            var notInUse;
            for (var i=0; i<dirtyChecklist.length; i++) {
                var n = dirtyChecklist[i];
                var watchers = n.object.watchers;
                notInUse = (
                        n.object == obj
                        && n.prop == prop
                        && watchers
                        && ( !watchers[prop] || watchers[prop].length == 0 )
                );
                if (notInUse)  {
                    dirtyChecklist.splice(i, 1);
                }
            }

        };

        setInterval(loop, 50);

        WatchJS.watch = watch;
        WatchJS.unwatch = unwatch;
        WatchJS.callWatchers = callWatchers;
        WatchJS.suspend = suspend; // suspend watchers
        WatchJS.onChange = trackChange;  // track changes made to object or  it's property and return a single change object

        return WatchJS;

    }));



    (function($){
        var lib={


            tpl : function(options) {
                options = $.extend({
                    left_split : "{{",
                    right_split : "}}",
                    tpl : "",
                    data : null
                }, options);
                if (options.data == null) {
                    return options.tpl;
                } else {
                    var reg = new RegExp(options.left_split + "(.+?)" + options.right_split, "gi");
                    var strs = options.tpl.match(reg), tpl = options.tpl;
                    for (var i = 0; i < strs.length; i++) {
                        var str = strs[i];
                        strs[i] = str.substring(options.left_split.length, str.length - (options.right_split.length));
                        tpl = tpl.replace(str, str.indexOf(".") == -1 ? (options.data[strs[i]]||'') : (this.getDataByModel(options.data,strs[i]))||'');
                    }
                    return tpl;
                }
            },
            getFormDataByMap:function(formData,map){
                var res={};
                for(var i in map){

                    res[map[i]]=formData[i];
                }
                return res;
            },
            reverseMap:function(map){
                var res={};
                for(var i in map){
                    res[map[i]]=i;
                }
                return res;
            },

            toggleArrayElement:function(item,arr){
                var index=arr.indexOf(item);
                if(index===-1){
                    arr.push(item);
                }else{
                    arr.splice(index,1);
                }
            },
            //检测数组重复元素
            isRepeat:function(arr){

                var hash = {};

                for(var i in arr) {

                    if(hash[arr[i]])

                        return true;

                    hash[arr[i]] = true;

                }

                return false;

            },
            //冒泡排序
            bubbleSort:function(arr){
                for(var i=0;i<arr.length;i++){
                    //内层循环，找到第i大的元素，并将其和第i个元素交换
                    for(var j=i;j<arr.length;j++){
                        if(arr[i]>arr[j]){
                            //交换两个元素的位置
                            var temp=arr[i];
                            arr[i]=arr[j];
                            arr[j]=temp;
                        }
                    }
                }
            },
            parseUrl: function (href) {
                var url = href || location.href;
                var a = document.createElement('a');
                a.href = url;
                var ret = {},
                        seg = a.search.replace(/^\?/, '').split('&'),
                        len = seg.length, i = 0, s;
                for (; i < len; i++) {
                    if (!seg[i]) {
                        continue;
                    }
                    s = seg[i].split('=');
                    ret[s[0]] = s[1];
                }
                return ret;
            },
            //以下为增强数据模型的获取，修改和找寻目标scope的方法
            getDataByModel:function($scope,modelStr,otherWiseVal){
                otherWiseVal=otherWiseVal||null;
                var arr=modelStr.split('.'),len=arr.length,result=$scope;
                if(len===1){
                    return $scope[arr[0]];
                }else if(len>1){
                    var isError=false;
                    for(var i in arr){
                        if(typeof(result[arr[i]])==='undefined'){
                            isError=true;
                            break;
                        }else{
                            result=result[arr[i]];
                        }
                    }
                    if(isError){
                        return otherWiseVal;
                    }else{
                        return result;
                    }
                }else if(len===0){
                    return otherWiseVal;
                }
            },
            setDataByModel:function($scope,modelStr,val){
                var arr=modelStr.split('.'),len=arr.length;
                if(len===1){
                    $scope[arr[0]]=val;
                }else if(len>1){
                    var ns=arr,obj=$scope;
                    for(var i=0;i<len-1;i++){
                        var key=ns[i];
                        obj=obj[key];
                    }
                    obj[ns[len-1]]=val;
                }
            },
            getTargetScopeByModel:function($currentScope,modelStr){
                var arr=modelStr.split('.'),len=arr.length;
                if(len===0){
                    return $currentScope;
                }else{
                    var key=arr[0],$pScope=$currentScope;
                    var loop=function(){
                        $pScope=$pScope.$parent;
                        if($pScope===null){
                            $pScope=null;
                        }else{
                            if(typeof($pScope[key])==='undefined'){
                                loop();
                            }
                        }

                    }
                    loop();
                    return $pScope;
                }
            },
            isDate:function(txtDate)
            {
                var currVal = txtDate;
                if(currVal == '')
                    return false;

                var rxDatePattern = /^(\d{4})(\/|-)(\d{1,2})(\/|-)(\d{1,2})$/; //Declare Regex
                var dtArray = currVal.match(rxDatePattern); // is format OK?

                if (dtArray == null)
                    return false;

                //Checks for mm/dd/yyyy format.
                var dtMonth = dtArray[3];
                var dtDay= dtArray[5];
                var dtYear = dtArray[1];

                if (dtMonth < 1 || dtMonth > 12)
                    return false;
                else if (dtDay < 1 || dtDay> 31)
                    return false;
                else if ((dtMonth==4 || dtMonth==6 || dtMonth==9 || dtMonth==11) && dtDay ==31)
                    return false;
                else if (dtMonth == 2)
                {
                    var isleap = (dtYear % 4 == 0 && (dtYear % 100 != 0 || dtYear % 400 == 0));
                    if (dtDay> 29 || (dtDay ==29 && !isleap))
                        return false;
                }
                return true;
            },
            filter:function(oFormData,aFilters){
                var result={};
                for(var i in oFormData){
                    if(aFilters.indexOf(i)!==-1){
                        result[i]=oFormData[i];
                    }
                }
                return result;
            },
            isSequentFromNo1:function(arr){
                var len=arr.length;
                if(len===0){
                    return false;
                }
                var str='',rightStr='';
                for(var i= 0;i<len;i++){
                    str+=arr[i];
                    rightStr+=(i+1);
                };

                return str===rightStr;
            },
            isDateTime:function(str,format){
                var reg=null;
                if(format==='y-m-d h:i:s'){
                    reg = /^(\d+)-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})$/;
                }else if(format==='y/m/d h:i:s'){
                    reg = /^(\d+)\/(\d{1,2})\/(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})$/;
                }else{
                    return true;
                }
                if(reg!==null){

                }
                //var reg = /^(\d+)-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})$/;
                var r = str.match(reg);
                if(r==null)return false;
                r[2]=r[2]-1;
                var d= new Date(r[1], r[2],r[3], r[4],r[5], r[6]);
                if(d.getFullYear()!=r[1])return false;
                if(d.getMonth()!=r[2])return false;
                if(d.getDate()!=r[3])return false;
                if(d.getHours()!=r[4])return false;
                if(d.getMinutes()!=r[5])return false;
                if(d.getSeconds()!=r[6])return false;
                return true;
            },
            getMapByObjIndex:function(eq,obj){
                var index=0,result={};
                for(var i in obj){
                    if(index==eq){
                        result.k=i;
                        result.v=obj[i];
                        break;
                    }
                    index++;
                }
                return result;
            },
            isNull:function(str){
                return (typeof(str)==='string'&&str.trim()==='')||(typeof(str)==='undefined')||(str===null);
            },
            isObject:function(obj){
                return obj===Object(obj);
            },
            isUndefined:function(obj){
                return typeof(obj)==='undefined';
            },
            isExist:function(obj,modelstr){
                var _ng={
                    isObject:lib.isObject,
                    isUndefined:lib.isUndefined
                }
                var exist=true;
                var arr=modelstr.split('.'),len=arr.length;
                if(!_ng.isObject(obj)){
                    exist=false;
                }
                else if(obj===null){
                    exist=false;
                }
                else if(_ng.isUndefined(obj)){
                    exist=false;
                }else{
                    for(var i in arr){
                        if(_ng.isUndefined(obj[arr[i]])){
                            exist=false;
                            break;
                        }
                        obj=obj[arr[i]];
                    }
                }

                return exist;
            },
            //getVal:function(obj,modelstr,otherwiseVal){
            //    var exist=this.isExist(obj,modelstr),val;
            //    if(exist){
            //        val=getDataByModel(obj,modelstr);
            //    }else{
            //        val=otherwiseVal||''
            //    }
            //    return val;
            //},
            getArrayByRepeatElement:function(obj,count){
                var arr=[];
                for(var i= 0;i<count;i++){
                    arr.push(obj);
                }
                return arr;
            },
            getDateStr:function(AddDayCount) {
                var dd = new Date();
                dd.setDate(dd.getDate()+AddDayCount);//获取AddDayCount天后的日期
                var y = dd.getFullYear();
                var m = dd.getMonth()+1;//获取当前月份的日期
                var d = dd.getDate();
                m=m<10?'0'+m:m;
                d=d<10?'0'+d:d;

                return y+"-"+m+"-"+d;
            },
            /*
             节流函数
             // Usage
             var myEfficientFn = debounce(function() {
             // All the taxing stuff you do
             }, 250);
             window.addEventListener('resize', myEfficientFn);
             */
            debounce:function(func, wait, immediate) {
                var timeout;
                return function() {
                    var context = this, args = arguments;
                    var later = function() {
                        timeout = null;
                        if (!immediate) func.apply(context, args);
                    };
                    var callNow = immediate && !timeout;
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                    if (callNow) func.apply(context, args);
                };
            },
            /*
             期望状态检查
             // Usage:  ensure element is visible
             poll(
             function() {
             return document.getElementById('lightbox').offsetWidth > 0;
             },
             function() {
             // Done, success callback
             },
             function() {
             // Error, failure callback
             }
             );
             */
            poll:function(fn, callback, errback, timeout, interval) {
                var endTime = Number(new Date()) + (timeout || 2000);
                interval = interval || 100;

                (function p() {
                    // If the condition is met, we're done!
                    if(fn()) {
                        callback();
                    }
                    // If the condition isn't met but the timeout hasn't elapsed, go again
                    else if (Number(new Date()) < endTime) {
                        setTimeout(p, interval);
                    }
                    // Didn't match and too much time, reject!
                    else {
                        errback(new Error('timed out for ' + fn + ': ' + arguments));
                    }
                })();
            },
            /*
             once函数
             // Usage
             var canOnlyFireOnce = once(function() {
             console.log('Fired!');
             });

             canOnlyFireOnce(); // "Fired!"
             canOnlyFireOnce(); // undefined
             */
            once:function(fn, context) {
                var result;

                return function() {
                    if(fn) {
                        result = fn.apply(context || this, arguments);
                        fn = null;
                    }

                    return result;
                };
            },
            /*
             // Usage
             getAbsoluteUrl('/something'); // http://davidwalsh.name/something
             */
            getAbsoluteUrl:(function() {
                var a;

                return function(url) {
                    if(!a) a = document.createElement('a');
                    a.href = url;

                    return a.href;
                };
            })(),
            /*
             插入样式:
             // Usage
             sheet.insertRule("header { float: left; opacity: 0.8; }", 1);
             */
            sheet: (function() {
                // Create the <style> tag
                var style = document.createElement('style');

                // Add a media (and/or media query) here if you'd like!
                // style.setAttribute('media', 'screen')
                // style.setAttribute('media', 'only screen and (max-width : 1024px)')

                // WebKit hack :(
                style.appendChild(document.createTextNode(''));

                // Add the <style> element to the page
                document.head.appendChild(style);

                return style.sheet;
            })()

        };
        $.extend(lib);


        var bx=window.bx={},
                moduleCollection={};
        function handleError(msg){
            alert('错误:'+msg);
        }
        function service(name,fn){
            var obj=fn();
            if(!lib.isObject(obj)){
                handleError(name+'这个service的函数返回的不是对象');
                return
            }
            if(!lib.isExist(serviceCollection,name)){
                serviceCollection[name]={};
            }
            serviceCollection[name]= $.extend(serviceCollection[name],obj);
        }
//        function
        function module(name){

            if(!lib.isExist(moduleCollection,name)){
                moduleCollection[name]={
                    service:service
                };
            }
            else{
                return moduleCollection[name];
            }


        }



//        _.service=service;


//        var ex1 = {
//            attr1: "initial value of attr1",
//            attr2: "initial value of attr2"
//        };
//
//
//        watch(ex1, "attr1", function(prop, action, newvalue, oldvalue){
//            console.log(prop+" - action: "+action+" - new: "+newvalue+", old: "+oldvalue+"... and the context: "+JSON.stringify(this));
//        });
//
//
//        ex1.attr1 = "other value";



    })(jQuery);
</script>




<!--<div ng-app="main" ng-controller="mainController">-->
    <!--<pagination res-total-num-key="total" res-data-key="data" page-handler-num="10" page-size="10" url="/test/fetchData?page={currentPage}&pageSize={pageSize}" datamodel="obj.data" transform-res-data-fn="transformResData">-->

    <!--</pagination>-->


    <!--<ul>-->
        <!--<li ng-repeat="item in obj.data">-->
            <!--{{item.id}}<br>{{item.name}}-->
        <!--</li>-->
    <!--</ul>-->


    <!--<p>Hello {{name}}!</p>-->
    <!--<input ng-model="name">-->
    <!--<div ng-if="ms.bool===true">-->
        <!--<input ng-model="ms.testtt">-->
    <!--</div>-->
    <!--<div ng-if="includeForm===true">-->
        <!--<input value="abc" ng-model="testtt">-->
    <!--</div>-->
    <!--<pre>-->
        <!--{{ms.testtt}}<br>-->
        <!--{{testtt}}-->
    <!--</pre>-->

<!--</div>-->









<!--<script>-->
    <!--(function ($) {-->
        <!--'use strict';-->
        <!--angular-->
                <!--.module('main', [-->
                    <!--'base'-->
                <!--])-->
                <!--.service('mainService', ['$http', '$rootScope', '$q', 'baseService', 'CONFIG', function ($http, $rootScope, $q, baseService, CONFIG) {-->

                    <!--var bs = baseService;-->

                    <!--var o = {-->
                        <!--bool:true,-->
                        <!--testtt:'aaaaaaaaa'-->
                    <!--};-->
                    <!--return o;-->
                <!--}])-->
                <!--.controller('mainController', ['$scope', '$http', '$rootScope', '$q', 'mainService', 'baseService', 'CONFIG', function ($scope, $http, $rootScope, $q, mainService, baseService, CONFIG) {-->
                    <!--var ms = $scope.ms = mainService,-->
                            <!--bs = $scope.bs = baseService,-->
                            <!--cfg = $scope.CONFIG = CONFIG;-->

                    <!--$scope.obj={-->
                        <!--data:[]-->
                    <!--}-->
                    <!--$scope.transformResData=function(data){-->

                    <!--}-->


                    <!--$scope.name = 'World';-->
                    <!--$scope.includeForm = true;-->
                    <!--$scope.testtt='aaaaaaa';-->

                <!--}])-->

    <!--})(jQuery);-->
<!--</script>-->